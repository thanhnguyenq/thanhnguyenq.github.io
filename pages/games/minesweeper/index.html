---
layout: default
title: MineSweeper
---
<table id="minesweeper">
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
</table>
<br>
<p>Version 0.1.1</p>
<style media="screen">
#minesweeper {
  max-width: 100%;
  table-layout:fixed;
}
#minesweeper tr td{
  cursor: default;
  width: 25px;
  height: 25px;
  line-height: 25px;
  display: inline-block;
  min-width: unset;
  color: #666;
  background: #666;
  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none; /* Safari */
  -khtml-user-select: none; /* Konqueror HTML */
  -moz-user-select: none; /* Firefox */
  -ms-user-select: none; /* Internet Explorer/Edge */
  user-select: none; /* Non-prefixed version, currently
  supported by Chrome and Opera */
}
#minesweeper tr td:hover {
  background: #666;
  color: #666;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript">
// disable default right click
document.oncontextmenu = function() {return false;};

var arr = initArr();
arr = markNumber(arr);
var arrMark = initArr();
var bomb = countBomb(arr);
var flag = true;
var isClear = false;

$("#minesweeper td").click(function() {
  var col = $(this).parent().children().index($(this));
  var row = $(this).parent().parent().children().index($(this).parent());
  if(arrMark[row][col] == -3 || arrMark[row][col] == -4) {
    return;
  }
  if(flag) {
    flag = false;
    while(arr[row][col] != 0) {
      arr = initArr();
      arr = markNumber(arr);
    }
    bomb = countBomb(arr);
  }
  if(arr[row][col] != -1) {
    if(arr[row][col] != 0) {
      $(this).css("background", "unset");
      arrMark[row][col] = -2;
      $(this).html(arr[row][col]);
    } else {
      discover(row, col);
    }
  } else {
    alert("You lose!");
    restart();
  }
});

// double click
$("#minesweeper td").dblclick(function(){
  var col = $(this).parent().children().index($(this));
  var row = $(this).parent().parent().children().index($(this).parent());
  if(arrMark[row][col] != -2 || arr[row][col] == 0) {
    return;
  }
  var bombCount = 0;

  // Top Left
  if(arr[row - 1] != null && arr[row - 1][col - 1] != null &&arrMark[row - 1][col - 1] == -3) {
    bombCount++;
  }
  // Top
  if(arr[row - 1] != null && arr[row - 1][col] != null && arrMark[row - 1][col] == -3) {
    bombCount++;
  }
  // Top Right
  if(arr[row - 1] != null && arr[row - 1][col + 1] != null && arrMark[row - 1][col + 1] == -3) {
    bombCount++;
  }
  // Right
  if(arr[row] != null && arr[row][col + 1] != null && arrMark[row][col + 1] == -3) {
    bombCount++;
  }
  // Bottom Right
  if(arr[row + 1] != null && arr[row + 1][col + 1] != null && arrMark[row + 1][col + 1] == -3) {
    bombCount++;
  }
  // Bottom
  if(arr[row + 1] != null && arr[row + 1][col] != null && arrMark[row + 1][col] == -3) {
    bombCount++;
  }
  // Bottom Left
  if(arr[row + 1] != null && arr[row + 1][col - 1] != null && arrMark[row + 1][col - 1] == -3) {
    bombCount++;
  }
  // Left
  if(arr[row] != null && arr[row][col - 1] != null && arrMark[row][col - 1] == -3) {
    bombCount++;
  }


  /*CHECK*/
  if(bombCount == arr[row][col]) {
    var table = $("#minesweeper")[0];
    var cell;
    // Top Left
    if(arr[row - 1] != null && arr[row - 1][col - 1] != null && arrMark[row - 1][col - 1] != -3) {
      cell = table.rows[row - 1].cells[col - 1];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Top
    if(arr[row - 1] != null && arr[row - 1][col] != null && arrMark[row - 1][col] != -3) {
      cell = table.rows[row - 1].cells[col];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Top Right
    if(arr[row - 1] != null && arr[row - 1][col + 1] != null && arrMark[row - 1][col + 1] != -3) {
      cell = table.rows[row - 1].cells[col + 1];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Right
    if(arr[row] != null && arr[row][col + 1] != null && arrMark[row][col + 1] != -3) {
      cell = table.rows[row].cells[col + 1];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Bottom Right
    if(arr[row + 1] != null && arr[row + 1][col + 1] != null && arrMark[row + 1][col + 1] != -3) {
      cell = table.rows[row + 1].cells[col + 1];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Bottom
    if(arr[row + 1] != null && arr[row + 1][col] != null && arrMark[row + 1][col] != -3) {
      cell = table.rows[row + 1].cells[col];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Bottom Left
    if(arr[row + 1] != null && arr[row + 1][col - 1] != null && arrMark[row + 1][col - 1] != -3) {
      cell = table.rows[row + 1].cells[col - 1];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
    // Left
    if(arr[row] != null && arr[row][col - 1] != null && arrMark[row][col - 1] != -3) {
      cell = table.rows[row].cells[col - 1];
      $(cell).trigger("click");
      if(isClear){
        isClear = false;
        return;
      }
    }
  } else {
    // TODO:
  }
});

$("#minesweeper td").mousedown(function(e){
  if( e.button == 2 ) {
    // Right mouse
    var col = $(this).parent().children().index($(this));
    var row = $(this).parent().parent().children().index($(this).parent());
    if(arrMark[row][col] != -2  && arrMark[row][col] != -3 && arrMark[row][col] != -4) {
      $(this).html('<i class="fa fa-flag" aria-hidden="true" style="color:wheat"></i>');
      arrMark[row][col] = -3;
    } else if(arrMark[row][col] == -3) {
      $(this).html('<i class="fa fa-question" aria-hidden="true" style="color:wheat"></i>');
      arrMark[row][col] = -4;
    } else if(arrMark[row][col] == -4) {
      $(this).html('');
      arrMark[row][col] = 0;
    }
    return false;
  }
  return true;
});

function initArr() {
  var arr = new Array(20);
  for (var i = 0; i < 20; i++) {
    arr[i] = new Array(20);
  }
  // Generate mines
  for (var i = 0; i < 80; i++) {
    var new_mine_row = Math.floor(Math.random() * 20);
    var new_mine_col = Math.floor(Math.random() * 20);
    arr[new_mine_row][new_mine_col] = -1;
  }
  for (var i = 0; i < 20; i++) {
    for (var j = 0; j < 20; j++) {
      if(arr[i][j] != -1) {
        arr[i][j] = 0;
      }
    }
  }
  return arr;
};

// Mark number around mine
function markNumber(arr) {
  for (var i = 0; i < 20; i++) {
    for (var j = 0; j < 20; j++) {
      if(arr[i][j] == -1) {
        // Top Left
        if(arr[i - 1] != null && arr[i - 1][j - 1] != null && arr[i - 1][j - 1] != -1) {
          arr[i - 1][j - 1] += 1;
        }
        // Top
        if(arr[i - 1] != null  && arr[i - 1][j] != null && arr[i - 1][j] != -1) {
          arr[i - 1][j] += 1;
        }
        // Top Right
        if(arr[i - 1] != null && arr[i - 1][j + 1] != null && arr[i - 1][j + 1] != -1) {
          arr[i - 1][j + 1] += 1;
        }
        // Right
        if(arr[i] != null && arr[i][j + 1] != null && arr[i][j + 1] != -1) {
          arr[i][j + 1] += 1;
        }
        // Bottom Right
        if(arr[i + 1] != null && arr[i + 1][j + 1] != null && arr[i + 1][j + 1] != -1) {
          arr[i + 1][j + 1] += 1;
        }
        // Bottom
        if(arr[i + 1] != null && arr[i + 1][j] != null && arr[i + 1][j] != -1) {
          arr[i + 1][j] += 1;
        }
        // Bottom Left
        if(arr[i + 1] != null && arr[i + 1][j - 1] != null && arr[i + 1][j - 1] != -1) {
          arr[i + 1][j - 1] += 1;
        }
        // Left
        if(arr[i] != null && arr[i][j - 1] != null && arr[i][j - 1] != -1) {
          arr[i][j - 1] += 1;
        }
      }
    }
  }
  return arr;
};

function discover(row, col) {
  // Is discovered?
  if(arrMark[row][col] == -2 || arrMark[row][col] == -3 || arrMark[row][col] == -4) {
    return;
  }
  var table = $("#minesweeper")[0];
  var cell = table.rows[row].cells[col];
  var $cell = $(cell);
  $cell.css("background", "unset");
  arrMark[row][col] = -2;
  if (arr[row][col] != 0) {
    $cell.html(arr[row][col]);
    return;
  }

  // Top Left
  if(arr[row - 1] != null && arr[row - 1][col - 1] != null && arr[row - 1][col - 1] != -1) {
    discover(row - 1, col - 1);
  }
  // Top
  if(arr[row - 1] != null && arr[row - 1][col] != null && arr[row - 1][col] != -1) {
    discover(row - 1, col);
  }
  // Top Right
  if(arr[row - 1] != null && arr[row - 1][col + 1] != null && arr[row - 1][col + 1] != -1) {
    discover(row - 1, col + 1);
  }
  // Right
  if(arr[row] != null && arr[row][col + 1] != null && arr[row][col + 1] != -1) {
    discover(row, col + 1);
  }
  // Bottom Right
  if(arr[row + 1] != null && arr[row + 1][col + 1] != null && arr[row + 1][col + 1] != -1) {
    discover(row + 1, col + 1);
  }
  // Bottom
  if(arr[row + 1] != null && arr[row + 1][col] != null && arr[row + 1][col] != -1) {
    discover(row + 1, col);
  }
  // Bottom Left
  if(arr[row + 1] != null && arr[row + 1][col - 1] != null && arr[row + 1][col - 1] != -1) {
    discover(row + 1, col - 1);
  }
  // Left
  if(arr[row] != null && arr[row][col - 1] != null && arr[row][col - 1] != -1) {
    discover(row, col - 1);
  }
};

function countBomb(arr) {
  var res = 0;
  for (var i = 0; i < 20; i++) {
    for (var j = 0; j < 20; j++) {
      if(arr[i][j] == -1) {
        res++;
      }
    }
  }
  return res;
}

function checkWin() {
  for (var i = 0; i < 20; i++) {
    for (var j = 0; j < 20; j++) {
      if(arrMark[i][j] == -2 || arr[i][j] == -1){
        continue;
      } else {
        return false;
      }
    }
  }
  alert("You win!");
  restart();
  return true;
}

function clearContent() {
  isClear = true;
  var table = $("#minesweeper")[0];
  for (var i = 0; i < 20; i++) {
    for (var j = 0; j < 20; j++) {
      var cell = table.rows[i].cells[j];
      var $cell = $(cell);
      $cell.html("");
    }
  }
}

function restart() {
  arr = initArr();
  arr = markNumber(arr);
  arrMark = initArr();
  bomb = countBomb(arr);
  clearContent();
  flag = true;
  $("#minesweeper td").css("background", "#666");
}

window.setInterval(checkWin, 500);
</script>
